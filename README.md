# PIO_Builder
C++ code for runtime generation of RPi RP2040 PIO programs

See `examples` for example code.

It can be included as a header in any other project using the pico sdk, and just
needs C++14 or later and to be linked against hardware_pio.

## Features

See the RP2040 documentation for details of the PIPO design.

A program can optionally have its length in commands, number of side set
pins, side set opt and side set pindirs set through template args, with
defaults used otherwise
```cpp
PIOBuilder::Program<LEN = 32, SIDE_SET_PINS = 0, SIDE_SET_OPT = false, SIDE_SET_PINDIRS = false>

using namespace PIOBuilder;

Program<> p;
```

Programs can be written instruction by instruction like in assembly
See `pio_builder.hpp` to see what options are available for each command

```cpp
p.pull(true);                 // pull block
p.out(OutDest::Y, 32);        // out y, 32
p.mov(MovDest::X, MovSrc::Y); // mov x, y
```

All instruction creation functions return the index of that function
which can be used as a label

```cpp
const auto nop_label = p.nop();       // nop
p.jmp(JmpCond::X_PostDec, nop_label); // jmp x-- nop_label
```

Where jumps point to addresses ahead of them, you need to add the label
to the jump once it has been created

```cpp
const auto jump = p.jmp(JmpCond::Always);              // jmp
p.nop();                                               // nop
const auto jump_target = p.mov(MovDest::X, MovDest::Y) // mov x, y
p.set_jmp_dest(jump, jump_target);                     // set jump dest address to jump_target
```

The last arguments to functions are delay, side step and side step enable

```cpp
p.nop(5, 1); // Delay 5 cycles, set sideset pins to 1
p.out(OutDest::X, 32, 3, 2) // out x, 32 side 2 [3]
```

wrap and wrap_target can be created similarly as expected

```cpp
p.wrap_target();
p.nop(5, 1);
p.nop(5, 0);
p.wrap();
```

Instructions can be placed at arbitrary addresses with <cmd>_at functions

```cpp
p.pull_at(4); // Place pull at address 4
```

The program can be loaded the PIOs similarly to the programs generated by
pioasm

```cpp
Program<> my_program;

my_program.wrap_target();
my_program.nop(5, 1);
my_program.nop(5, 0);
my_program.wrap();

auto offset = pio_add_program(pio0, my_program);
// ...
pio_sm_config c = my_program.get_default_config(offset);
// ...
```
